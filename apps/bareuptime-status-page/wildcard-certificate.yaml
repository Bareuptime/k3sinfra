apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: bareuptime-online-wildcard-tls
  namespace: bareuptime-backend
spec:
  # Secret where the certificate will be stored
  secretName: bareuptime-online-wildcard-tls

  # Use production Let's Encrypt
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer

  # Domains covered by this certificate
  dnsNames:
    - '*.bareuptime.online'
    - 'bareuptime.online'

---
# INSTRUCTIONS TO SETUP WILDCARD CERTIFICATE:
#
# Prerequisites:
# - cert-manager installed (see k3sinfra/infra/k3s/cert-manager/)
# - ClusterIssuer with DNS-01 solver configured
#
# Step 1: Create Cloudflare API token
# ====================================
# 1. Go to https://dash.cloudflare.com/profile/api-tokens
# 2. Click "Create Token"
# 3. Use template: "Edit zone DNS"
# 4. Zone Resources: Include -> Specific zone -> bareuptime.online
# 5. Copy the generated token
#
# Step 2: Create Cloudflare API token secret
# ==========================================
# kubectl create secret generic cloudflare-api-token-secret \
#   --from-literal=api-token='YOUR_CLOUDFLARE_API_TOKEN' \
#   -n cert-manager
#
# Step 3: Update ClusterIssuer with DNS-01 solver
# ===============================================
# The ClusterIssuer needs DNS-01 challenge solver for wildcard certificates.
# Edit: k3sinfra/infra/k3s/cert-manager/manifests/letsencrypt-prod-cloudflare.yaml
# Then apply:
#
# kubectl apply -f k3sinfra/infra/k3s/cert-manager/manifests/letsencrypt-prod-cloudflare.yaml
#
# Verify it's ready:
# kubectl get clusterissuer letsencrypt-prod
#
# Step 4: Apply this certificate configuration
# ============================================
# kubectl apply -f k3sinfra/apps/bareuptime-status-page/wildcard-certificate.yaml
#
# Step 5: Check certificate status
# ================================
# kubectl get certificate -n bareuptime-backend
# kubectl describe certificate bareuptime-online-wildcard-tls -n bareuptime-backend
#
# If you see any errors, check cert-manager logs:
# kubectl logs -n cert-manager deployment/cert-manager
#
# The certificate should be issued within a few minutes (DNS propagation time).
# Once ready, your ingress will automatically use it for *.bareuptime.online domains.
